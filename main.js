(()=>{"use strict";var t={baseUrl:"https://nomoreparties.co/v1/wff-cohort-31",headers:{authorization:"43917973-2feb-4cdf-bfd1-0dbc7bf82d22","Content-Type":"application/json"}},e=document.querySelector("#card-template").content.querySelector(".places__item"),r=function(t,r,o,n,u){var c=e.cloneNode(!0),i=c.querySelector(".card__image"),a=c.querySelector(".card__title"),s=c.querySelector(".card__delete-button"),l=c.querySelector(".card__like-button"),p=c.querySelector(".card__image"),_=c.querySelector(".card__like-counter");return i.src=t.link,i.alt="Картинка с ".concat(t.name),a.textContent=t.name,_.textContent=0,s.addEventListener("click",(function(){return r(s,".card",t._id)})),l.addEventListener("click",(function(){return o(l,_,t._id)})),p.addEventListener("click",(function(){return n(i.src,i.alt)})),u&&u!==t.owner._id&&s.remove(),u&&(_.textContent=t.likes.length,t.likes.some((function(t){return t._id===u}))&&l.classList.add("card__like-button_is-active")),c},o=function(e,r,o){var n;e.closest(r).remove(),(n=o,fetch("".concat(t.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).catch((function(t){console.log(t)}))},n=function(t,e,r){t.classList.toggle("card__like-button_is-active")?u(r,e):c(r,e)},u=function(e,r){var o;(o=e,fetch("".concat(t.baseUrl,"/cards/likes/").concat(o),{method:"PUT",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){return r.textContent=t.likes.length})).catch((function(t){console.log(t)})),r.textContent++},c=function(e,r){var o;(o=e,fetch("".concat(t.baseUrl,"/cards/likes/").concat(o),{method:"DELETE",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).then((function(t){return r.textContent=t.likes.length})).catch((function(t){console.log(t)})),r.textContent--},i=null,a=function(t){"Escape"===t.key&&l(i)},s=function(t){t.classList.add("popup_is-animated"),setTimeout((function(){return t.classList.add("popup_is-opened")}),100),document.addEventListener("keydown",a),i=t},l=function(t){t.closest(".popup").classList.remove("popup_is-opened"),setTimeout((function(){return t.closest(".popup").classList.remove("popup_is-animated")}),1e3),document.removeEventListener("keydown",a),i=null};function p(t,e,r,o){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(r),n.classList.remove(o),n.textContent=""}function _(t,e,r){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(r),e.disabled=!1):(e.classList.add(r),e.disabled=!0)}function d(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){!function(t,e,r,o,n,u){var c=Array.from(t.querySelectorAll(e)),i=t.querySelector(r);_(c,i),c.forEach((function(e){e.addEventListener("input",(function(){!function(t,e,r,o){e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity(""),e.validity.valid?p(t,e,r,o):function(t,e,r,o,n){var u=t.querySelector(".".concat(e.id,"-error"));e.classList.add(o),u.textContent=r,u.classList.add(n)}(t,e,e.validationMessage,r,o)}(t,e,n,u),_(c,i,o)}))}))}(e,t.inputSelector,t.submitButtonSelector,t.inactiveButtonClass,t.inputErrorClass,t.errorClass)}))}function f(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(r){p(t,r,e.inputErrorClass,e.errorClass)}));var r=t.querySelector(e.submitButtonSelector);r.classList.add(e.inactiveButtonClass),r.disabled=!0}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,o=Array(e);r<e;r++)o[r]=t[r];return o}var y=document.querySelector(".profile__edit-button"),v=document.querySelector(".profile__add-button"),b=document.querySelector(".profile__image"),h=document.querySelectorAll(".popup__close"),S=document.querySelectorAll(".popup"),C=document.querySelector(".popup_type_edit"),g=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),E=document.querySelector(".popup_type_new-avatar"),k=q.querySelector(".popup__image"),L=q.querySelector(".popup__caption"),j=document.forms.edit_profile,x=document.forms.new_place,A=document.forms.new_avatar,B=j.querySelector(".popup__input_type_name"),P=j.querySelector(".popup__input_type_description"),w=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),T=x.querySelector(".popup__input_type_card-name"),O=x.querySelector(".popup__input_type_url"),D=A.querySelector(".popup__input_type_url"),I=document.querySelector(".places__list"),M=function(t,e){s(q),k.setAttribute("src",t),k.setAttribute("alt",e),L.textContent=e};function N(t,e){t.textContent=e?"Сохранение...":"Сохранить"}y.addEventListener("click",(function(){B.value=w.textContent,P.value=U.textContent,s(C),d({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),f(C,{submitButtonSelector:".popup__button",inputSelector:".popup__input",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),v.addEventListener("click",(function(){s(g),d({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),f(g,{submitButtonSelector:".popup__button",inputSelector:".popup__input",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),b.addEventListener("click",(function(){s(E),d({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),f(E,{submitButtonSelector:".popup__button",inputSelector:".popup__input",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"})})),j.addEventListener("submit",(function(e){e.preventDefault();var r,o,n=B.value,u=P.value,c=e.target.querySelector(".popup__button");N(c,!0),w.textContent=n,U.textContent=u,(r=n,o=u,fetch("".concat(t.baseUrl,"/users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:r,about:o})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).catch((function(t){console.log(t)})).finally((function(){return N(c,!1)})),l(e.target)})),x.addEventListener("submit",(function(e){e.preventDefault();var r,o,n=e.target.querySelector(".popup__button"),u=T.value,c=O.value;N(n,!0),(r=u,o=c,fetch("".concat(t.baseUrl,"/cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:r,link:o})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).catch((function(t){console.log(t)})).finally((function(){return N(n,!1)})),x.reset(),l(e.target)})),A.addEventListener("submit",(function(e){e.preventDefault();var r,o=D.value,n=e.target.querySelector(".popup__button");N(n,!0),(r=o,fetch("".concat(t.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:r})}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))).catch((function(t){console.log(t)})).finally((function(){return N(n,!1)})),A.reset(),l(e.target)})),S.forEach((function(t){t.addEventListener("click",(function(e){e.target===t&&l(e.target)}))})),h.forEach((function(t){t.addEventListener("click",(function(t){return l(t.target)}))})),Promise.all([fetch("".concat(t.baseUrl,"/users/me"),{headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject(t.status)})),fetch("".concat(t.baseUrl,"/cards"),{headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject(t.status)}))]).then((function(t){var e,u,c=(u=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var o,n,u,c,i=[],a=!0,s=!1;try{if(u=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;a=!1}else for(;!(a=(o=u.call(r)).done)&&(i.push(o.value),i.length!==e);a=!0);}catch(t){s=!0,n=t}finally{try{if(!a&&null!=r.return&&(c=r.return(),Object(c)!==c))return}finally{if(s)throw n}}return i}}(e,u)||function(t,e){if(t){if("string"==typeof t)return m(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}(e,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=c[0],a=c[1];document.querySelector(".profile__title").textContent=i.name,document.querySelector(".profile__description").textContent=i.about,document.querySelector(".profile__image").style.backgroundImage="url(".concat(i.avatar,")"),a.forEach((function(t){I.append(r(t,o,n,M,i._id))}))})).catch((function(t){console.log(t)}))})();